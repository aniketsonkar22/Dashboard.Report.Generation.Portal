<div class="dialog-header">
  <h2 mat-dialog-title class="dialog-title">
    <div>
      <mat-icon>business</mat-icon>
      <div class="dialog-title-text"> {{ data.kpiName }} Departments</div>
    </div>
   
    <div class="department-count">{{ getDepartments().length || 0 }} departments</div>

  </h2>
</div>

<mat-dialog-content class="dialog-content">
  <div *ngIf="getDepartments().length === 0" class="empty-state">
    <mat-icon>business_off</mat-icon>
    <span>No departments assigned</span>
  </div>
  
  <div *ngIf="getDepartments().length" class="departments-container">
    <div *ngFor="let department of getDepartments()" class="department-card">
      <div class="department-info">
        <div class="department-main">
          <span class="department-name">{{ department.name }}</span>
          <mat-chip color="primary" class="status-chip">
            {{ department.isActive ? 'Active' : 'Inactive' }}
          </mat-chip>
        </div>
        <div class="department-details">
          <span class="created-by">Created by: {{ department.createdBy }}</span>
          <span class="created-date">{{ department.createdAt | date:'short' }}</span>
        </div>
        
        <!-- KPI List Section -->
        <div class="kpis-section">
          <div class="kpis-header">
            <span class="kpis-title">KPIs:</span>
          </div>
          <div *ngIf="isLoadingKpis(department.id)" class="loading-kpis">
            <mat-spinner diameter="20"></mat-spinner>
            <span>Loading KPIs...</span>
          </div>
          <div *ngIf="!isLoadingKpis(department.id) && getGroupedKpisForDepartment(department.id).length > 0" class="kpis-list">
            <div *ngFor="let groupedKpi of getGroupedKpisForDepartment(department.id)" class="kpi-item">
              <div class="kpi-info">
                <span class="kpi-name">{{ groupedKpi.kpiName }}</span>
              </div>
              <button 
                mat-icon-button 
                color="primary" 
                (click)="editKpiTarget(department.id, groupedKpi)"
                matTooltip="Edit monthly target and actual values"
                class="edit-btn">
                <mat-icon>edit</mat-icon>
              </button>
            </div>
          </div>
          <div *ngIf="!isLoadingKpis(department.id) && getGroupedKpisForDepartment(department.id).length === 0" class="no-kpis">
            <span>No KPIs found for this department</span>
          </div>
        </div>
      </div>
      <button 
        mat-icon-button 
        color="warn" 
        (click)="removeKpiFromDepartment(department.id)"
        matTooltip="Remove KPI from department"
        class="remove-btn">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions class="dialog-actions">
  <button mat-button (click)="dialogRef.close()">Close</button>
</mat-dialog-actions>
